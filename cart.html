<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">

  <title>Your Cart | Ka’Mali Kosmetics</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Review your Ka’Mali Kosmetics cart and proceed to secure checkout.">

  <link rel="stylesheet" href="css/styles.css">
</head>

<body>

  <!-- HERO HEADER -->
  <header class="hero">
    <h1>Your Beauty Basket</h1>
    <p>Intentional beauty, chosen with care</p>
  </header>

  <!-- CART ITEMS -->
  <section class="section" id="cart-items">
    <!-- Items are injected here -->
  </section>

  <!-- TOTAL + CHECKOUT -->
  <section class="section">
    <h2 id="total">Total: $0.00</h2>

    <!-- THIS IS THE BUTTON -->
    <button class="cta" onclick="checkout()">
      Proceed to Secure Checkout
    </button>
  </section>

  <!-- LOAD CART LOGIC FIRST -->
  <script src="js/cart.js"></script>

  <!-- LOAD STRIPE -->
  <script src="https://js.stripe.com/v3/"></script>

  <!-- CHECKOUT + CART DISPLAY LOGIC -->
  <script>
    /* ============================
       STRIPE SETUP
    ============================ */

    const stripe = Stripe("pk_live_51S4ZcuGkWFSwF1eu2Sg7Tck9bAkC1CFsASe0ELQoRWdZ3phje7GNUmZ6ZR8DA5MYY6XcIsd9JKnvnY6laSY1VweH00perUGW0m");

    /* ============================
       DISPLAY CART
    ============================ */

    const container = document.getElementById("cart-items");
    const totalEl = document.getElementById("total");

    let total = 0;

    if (!cart || cart.length === 0) {
      container.innerHTML = "<p>Your cart is currently empty.</p>";
    } else {
      cart.forEach(item => {
        total += item.price * item.qty;

        container.innerHTML += `
          <div class="cart-item">
            <img src="${item.image}" alt="${item.name}">
            <div>
              <h3>${item.name}</h3>
              <p>$${item.price}</p>

              <div class="qty">
                <button onclick="decreaseQty(${item.id})">−</button>
                <span>${item.qty}</span>
                <button onclick="increaseQty(${item.id})">+</button>
              </div>

              <button onclick="removeItem(${item.id})">Remove</button>
            </div>
          </div>
        `;
      });
    }

    totalEl.innerText = "Total: $" + total.toFixed(2);

    /* ============================
       CHECKOUT FUNCTION
    ============================ */

    function checkout() {
      if (!cart || cart.length === 0) {
        alert("Your cart is empty.");
        return;
      }

      const lineItems = cart.map(item => ({
        price_data: {
          currency: "usd",
          product_data: {
            name: item.name
          },
          unit_amount: item.price * 100
        },
        quantity: item.qty
      }));

      stripe.redirectToCheckout({
        lineItems: lineItems,
        mode: "payment",
        successUrl: window.location.origin + "/success.html",
        cancelUrl: window.location.origin + "/cart.html"
      });
    }
  </script>

</body>
</html>
